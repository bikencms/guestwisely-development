var _floaterHidden=!0,_priceCalculating=!1;function hideServiceFeeNotIncluded(e="",l){0===parseInt(e.replaceAll(/[^0-9,]/g,""))?l.parent().hide():(l.parent().show(),l.html(e))}function calculatePrice(){if(!0===_priceCalculating)return;_priceCalculating=!0;var e=jQuery("#_villas-365-property-floater #_villas-365-property-floater-price-details-row"),l=jQuery("#_villas-365-property-floater #_villas-365-property-floater-price-details-button"),t=jQuery("#_villas-365-property-floater #_villas-365-property-floater-price-per-night"),a=t.data("defaultPerNight"),r=t.data("rateLabel"),o=t.data("rateLabelPlural"),i=jQuery("#_villas-365-property-floater #_villas-365-property-floater-price-details-discount-container"),s=jQuery("#_villas-365-property-floater #_villas-365-property-floater-price-details-label-per-night"),n=jQuery("#_villas-365-property-floater #_villas-365-property-floater-price-details-per-night"),p=jQuery("#_villas-365-property-floater #_villas-365-property-floater-price-details-fees"),d=jQuery("#_villas-365-property-floater #_villas-365-property-floater-price-details-tax"),c=jQuery("#_villas-365-property-floater #_villas-365-property-floater-price-details-discount"),u=jQuery("#_villas-365-property-floater #_villas-365-property-floater-total-label"),f=jQuery("#_villas-365-property-floater #_villas-365-property-floater-total"),h=jQuery("#_villas-365-property-floater").data("propertyId"),y=jQuery("#_villas-365-property-floater input[name='checkin']").val(),v=jQuery("#_villas-365-property-floater input[name='checkout']").val(),_=jQuery("#_villas-365-property-floater #_villas-365-adults").val(),m=jQuery("#_villas-365-property-floater #_villas-365-children").val(),j=jQuery("#_villas-365-property-floater #_villas-365-property-floater-minimum-nights-container"),Q=jQuery("#_villas-365-property-floater #_villas-365-property-floater-minimum-nights"),g=jQuery("#_villas-365-property-floater #_villas-365-property-floater-minimum-nights-dates-text");let w=jQuery("#_villas-365-property-floater #_villas-365-property-floater-discount-row"),C=jQuery("#_villas-365-property-floater #_villas-365-property-floater-discount-row ._villas-365-property-discount-text");""!==y&&""!==v&&""!==_?(f.removeClass("text-center"),f.html('<i class="fas fa-spinner fa-spin"></i>'),t.html('<i class="fas fa-spinner fa-spin"></i>'),s.html('<i class="fas fa-spinner fa-spin"></i>'),n.html('<i class="fas fa-spinner fa-spin"></i>'),p.html('<i class="fas fa-spinner fa-spin"></i>'),d.html('<i class="fas fa-spinner fa-spin"></i>'),c.html('<i class="fas fa-spinner fa-spin"></i>'),w.hide(),C.html(""),i.hide(),jQuery.ajax({type:"POST",url:_villas_365_wp_ajax.ajax_url,dataType:"json",data:{_ajax_nonce:_villas_365_wp_ajax.nonce,action:"_villas_365_calculate_booking",propertyId:h,checkIn:y,checkOut:v,adults:_,children:m}}).done(function(h){if(_priceCalculating=!1,"success"===h.data.status)if(u.removeClass("d-none"),f.html(h.data.total),t.html(h.data.perNight+"/"+r),e.removeClass("d-none"),s.html(h.data.perNight+" x "+h.data.totalNights+" "+(h.data.totalNights>1?o:r)),n.html(h.data.rentTotal),hideServiceFeeNotIncluded(h.data.serviceTotal,p),hideServiceFeeNotIncluded(h.data.taxTotal,d),void 0!==h.data.discountTotal&&null!==h.data.discountTotal&&""!==h.data.discountTotal&&(i.show(),c.html(h.data.discountTotal)),"false"===h.data.numberOfNightsOk?(j.show(),Q.text(h.data.minimumNights),g.show()):j.hide(),void 0!==h.data.discount&&h.data.discount.length>0){C.text=h.data.discount[0];for(const e of h.data.discount)C.append("<div class='_villas-365-property-discount-text-item'>&nbsp;-&nbsp;"+e.name+"</div>");w.show()}else w.hide(),C.html("");else"error"===h.data.status&&""!==h.data.message?(u.addClass("d-none"),f.addClass("text-center"),f.html(h.data.message),t.html(a),showPriceDetails(l,!0),e.addClass("d-none"),s.html("?"),n.html("?"),p.html("?"),d.html("?"),i.hide(),c.html("?"),j.show(),Q.text(Q.data("defaultMinimumNights")),g.hide()):(u.addClass("d-none"),f.addClass("text-center"),f.html("We're sorry, an error occurred."),t.html(a),showPriceDetails(l,!0),e.addClass("d-none"),s.html("?"),n.html("?"),p.html("?"),d.html("?"),i.hide(),c.html("?"),j.show(),Q.text(Q.data("defaultMinimumNights")),g.hide())}).fail(function(r){_priceCalculating=!1,u.addClass("d-none"),f.addClass("text-center"),f.html("We're sorry, an error occurred."),t.html(a),showPriceDetails(l,!0),e.addClass("d-none"),s.html("?"),n.html("?"),p.html("?"),d.html("?"),i.hide(),c.html("?"),j.show(),Q.text(Q.data("defaultMinimumNights")),g.hide()})):(u.addClass("d-none"),f.html(""),t.html(a),showPriceDetails(l,!0),e.addClass("d-none"),s.html("?"),n.html("?"),p.html("?"),d.html("?"),i.hide(),c.html("?"),w.hide(),_priceCalculating=!1)}function goToBookingPage(e,l){var t=e.attr("href"),a=jQuery("#_villas-365-property-floater").data("propertyId"),r=jQuery("#_villas-365-property-floater input[name='checkin']").val(),o=jQuery("#_villas-365-property-floater input[name='checkout']").val(),i=jQuery("#_villas-365-property-floater #_villas-365-adults").val(),s=jQuery("#_villas-365-property-floater #_villas-365-children").val();t=t+"?property="+a,""!==r&&(t+="&checkin="+r),""!==o&&(t+="&checkout="+o),""!==i&&(t+="&adults="+i),""!==s&&(t+="&children="+s),void 0!==l&&""!==l&&(t+="&mode="+l),document.location.href=t}function showPriceDetails(e,l){void 0===l&&(l=!1);var t=jQuery("#_villas-365-property-floater #_villas-365-property-floater-price-details-row ._villas-365-property-floater-price-details-container");if(t.data("collapsed")&&!l){t.slideDown(),t.data("collapsed",!1),e.removeClass("collapsed");var a=e.find(".rotate");void 0===(r=e.data("rotateClass"))&&(r="rotate-180"),a.removeClass("rotate-0"),a.addClass(r)}else if(!t.data("collapsed")||l){t.slideUp(),t.data("collapsed",!0),e.addClass("collapsed");var r;a=e.find(".rotate");void 0===(r=e.data("rotateClass"))&&(r="rotate-180"),a.removeClass(r),a.addClass("rotate-0")}}function openModalFloater(e,l){e.toggleClass("_villas-365-property-floater-visible",_floaterHidden),setTimeout(function(){l.toggleClass("_villas-365-property-floater-show",_floaterHidden),_floaterHidden=!_floaterHidden},50)}function closeModalFloater(e,l){l.removeClass("_villas-365-property-floater-show"),setTimeout(function(){e.removeClass("_villas-365-property-floater-visible"),_floaterHidden=!0},350)}function setupTabButton(){let e=jQuery("body"),l=!1,t=jQuery("#_villas-365-property-floater-modal-button");if(t.length>0&&_365_floaterModal?(l=!0,jQuery("#_villas-365-property-floater-tab-button").remove()):t=jQuery("#_villas-365-property-floater-tab-button"),0==t.length)return;l||(t.remove(),e.append(t));let a=jQuery("#_villas-365-property-floater");t.on("click",function(l){l.preventDefault(),_floaterHidden?openModalFloater(e,a):closeModalFloater(e,a)}),jQuery("#_villas-365-property-floater-close-button").on("click",function(){closeModalFloater(e,a)}),jQuery(window).on("resize",function(){jQuery(window).width()>=_365_floaterModalBreakPoint&&!_floaterHidden&&(e.removeClass("_villas-365-property-floater-visible"),a.removeClass("_villas-365-property-floater-show"),_floaterHidden=!0)})}function setupModal(){let e=jQuery("body"),l=jQuery("#_villas-365-property-floater-container");0!=l.length&&(l.remove(),e.append(l))}jQuery(document).ready(function(){"undefined"==typeof _365_floaterModalBreakPoint&&(_365_floaterModalBreakPoint=992),"undefined"==typeof _365_floaterModal&&(_365_floaterModal=!1),jQuery("#_villas-365-property-floater #_villas-365-adults, #_villas-365-property-floater #_villas-365-children").on("change",function(){calculatePrice()}),jQuery("#_villas-365-property-floater #_villas-365-checkin, #_villas-365-property-floater #_villas-365-checkout").on("change",function(){calculatePrice()}),jQuery("#_villas-365-property-floater ._villas-365-property-floater-enquire-button").on("click",function(e){e.preventDefault(),goToBookingPage(jQuery(this),"inquiry")}),jQuery("#_villas-365-property-floater ._villas-365-property-floater-book-now-button").on("click",function(e){e.preventDefault(),goToBookingPage(jQuery(this),"book")}),jQuery("#_villas-365-property-floater #_villas-365-property-floater-price-details-button").on("click",function(e){showPriceDetails(jQuery(this))});var e=_CookieRead("villas365SearchCheckin"),l=_CookieRead("villas365SearchCheckout"),t=_CookieRead("villas365SearchGuests"),a=0,r=jQuery("._villas-365-date-range-container ._villas-365-date-control-start").mobiscroll("getInst"),o=[];null!==r&&null!=e&&""!==e&&(o.push(moment(e,"YYYY-MM-DD").toDate()),jQuery("#_villas-365-checkin").val(e),a++);null!==r&&null!=l&&""!==l&&(o.push(moment(l,"YYYY-MM-DD").toDate()),jQuery("#_villas-365-checkout").val(l),a++);if(null!==r&&r.setVal(o),null!=t&&""!==t){var i=jQuery("#_villas-365-adults");i.find("option:selected").removeAttr("selected"),i.find("option[value='"+t+"']").attr("selected","selected"),i.trigger("chosen:updated"),a++}3==a&&calculatePrice(),setupTabButton()});var _floaterTopPadding=0,_floaterScrollPoint=0,_footerScrollTop=null;function calculateFloaterOffsets(){let e=jQuery("#_villas-365-property-floater-anchor"),l=jQuery("#main-header"),t=0;if(l.length>0)t=l.height();else{let e=jQuery("._villas-365-main-header");if(e.length>0)e.each(function(){t+=jQuery(this).height()});else{let e=jQuery("header");e.length>0&&(t=e.height())}}let a=0;jQuery("._villas-365-secondary-header").each(function(){a+=jQuery(this).height()});let r=jQuery("#wpadminbar"),o=0;r.length>0&&(o=r.height()),_floaterTopPadding=t+a+o+60,_floaterScrollPoint=e.offset().top-_floaterTopPadding}function positionFloater(){let e=jQuery("#_villas-365-property-floater"),l=e.find("._villas-365-property-floater-content"),t=jQuery(document).scrollTop();if(jQuery(document).scrollTop()>_floaterScrollPoint){(e.offset().top+l.height()>jQuery("footer").offset().top-50||null!=_footerScrollTop)&&(null==_footerScrollTop||t>=_footerScrollTop)?(null==_footerScrollTop&&(_footerScrollTop=t),e.css("top",_floaterTopPadding-30-(t-_footerScrollTop)+"px")):(_footerScrollTop=null,e.addClass("float"),e.css("top",_floaterTopPadding-30+"px"))}else e.removeClass("float"),e.css("top","-30px")}function removeFloater(){var e=jQuery("#_villas-365-property-floater");e.removeClass("float"),e.css("top","-30px")}jQuery(document).ready(function(){calculateFloaterOffsets(),positionFloater(),jQuery(window).on("scroll",function(){jQuery(window).width()>=992&&jQuery(window).height()>=700&&positionFloater()}),jQuery(window).on("resize",function(){jQuery(window).width()>=992&&jQuery(window).height()>=700?(calculateFloaterOffsets(),positionFloater()):jQuery(window).height()<700&&removeFloater()})});
